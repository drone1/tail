!function(t,e){t.Tail=e()}(this,function(){"use strict";function t(t){this.m_Canvas=document.getElementById(t.canvas_id),this.m_nRootX=t.root_pos_x,this.m_nRootY=t.root_pos_y,this.m_flBaseAngle=CatUtils.DegreesToRadians(t.base_angle),this.m_cSegments=Math.max(2,t.segment_count),this.m_flTailLengthPercentage=t.tail_length,this.m_strFillColor=t.fill_color,this.m_strStrokeColor=t.stroke_color,this.m_flStrokeWidth=t.stroke_width,this.m_flStartWidth=t.start_width,this.m_flEndWidth=t.end_width,this.m_bCollideWithFloor=t.collide_with_floor,this.m_fnGetMaxAngle=t.get_max_angle_func,this.m_fnGetCurlynessPoints=t.get_curlyness_points_func,this.m_fnGetCurlynessValues=t.get_curlyness_values_func,this.m_fnGetTailWidthPoints=t.get_tail_width_points,this.m_fnGetTailWidthValues=t.get_tail_width_values,this.m_fnFrantic=t.frantic_func,this.m_bAnimate=void 0!==t.animate?t.animate:!0,this.m_flNoiseBase=1e4*Math.random(),this.m_bFirstFrame=!0,this.m_Noise=new SimplexNoise}return t.prototype.Render=function(){var t=this.m_Canvas.getContext("2d");t.save();var e=this.m_bAnimate?CatUtils.GetTime():0,i=this.m_Canvas.width,s=this.m_Canvas.height,r=this.m_strStrokeColor&&this.m_strStrokeColor.length&&this.m_flStrokeWidth>1;t.clearRect(0,0,i,s);var n=i/this.m_cSegments*this.m_flTailLengthPercentage;t.lineCap="round",(this.m_fnGetCurlynessPoints(e).length!==this.m_fnGetCurlynessValues(e).length||this.m_fnGetTailWidthPoints(e).length!==this.m_fnGetTailWidthValues(e).length)&&console.error("Error: These need to be the same size, and both sorted in ascending order.");for(var o=r?2:1,h=0;o>h;++h){var a=o>1&&0==h,l=0,m=this.m_nRootX,_=this.m_nRootY;t.save(),t.translate(this.m_nRootX,this.m_nRootY);for(var f=0;f<this.m_cSegments;++f){var u=f/this.m_cSegments,d=this.GetTailWidth(e,u),p=this.m_Noise.noise(this.m_flNoiseBase+1e4+e+.5*u,100),c=this.GetCurlyness(e,u),g=this.m_fnFrantic(e,u),v=this.m_fnGetMaxAngle(e,u),C=this.m_flBaseAngle+c*Math.min(CatUtils.DegreesToRadians(Math.sin(e+2*Math.PI*u*p*g)*v),v),y=m+n*Math.cos(C),M=_+n*Math.sin(C),S=!1;this.m_bCollideWithFloor&&M>this.m_nRootY&&(M=this.m_nRootY,S=!0),S&&(C=0);var G=C-l;l=C,t.rotate(G);var T,W;a?(T=d*this.m_flStrokeWidth,W=this.m_strStrokeColor):(T=d,W=this.m_strFillColor),t.lineWidth=T,t.strokeStyle=W,t.beginPath(),t.moveTo(0,0),t.lineTo(n,0),t.stroke(),f<this.m_cSegments-1&&t.translate(n,0),m=y,_=M}t.restore()}t.restore(),this.m_bFirstFrame=!1},t.prototype.GetCurlyness=function(t,e){var i=this.m_fnGetCurlynessPoints(t),s=this.m_fnGetCurlynessValues(t),r=CatUtils.BinarySearch(e,i);return CatUtils.Interpolate(e,i[r],i[r+1],s[r],s[r+1])},t.prototype.GetTailWidth=function(t,e){var i=this.m_fnGetTailWidthPoints(t),s=this.m_fnGetTailWidthValues(t),r=CatUtils.BinarySearch(e,i);return CatUtils.Interpolate(e,i[r],i[r+1],s[r],s[r+1])},t.prototype.LogIfFirstFrame=function(t){this.m_bFirstFrame&&console.log(t)},t});var CatUtils={GetTime:function(){return(new Date).getTime()/1e3},Clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},Interpolate:function(t,e,i,s,r){if(e==i)return t>=i?r:s;var n=CatUtils.Clamp((t-e)/(i-e),0,1);return s+(r-s)*CatUtils.SCurve(n)},SCurve:function(t){var e=t*t;return 3*e-2*e*t},DegreesToRadians:function(t){return t*Math.PI/180},BinarySearch:function(t,e){for(var i=parseInt(e.length/2);i>=0&&i<e.length;)if(t>=e[i]){if(t<=e[i+1])break;++i}else--i;return i}},SimplexNoise=function(){var t=function(){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var t=0;256>t;t++)this.p[t]=Math.floor(256*Math.random());this.perm=[];for(var t=0;512>t;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};return t.prototype.dot=function(t,e,i){return t[0]*e+t[1]*i},t.prototype.noise=function(t,e){var i,s,r,n,o,h=.5*(Math.sqrt(3)-1),a=(t+e)*h,l=Math.floor(t+a),m=Math.floor(e+a),_=(3-Math.sqrt(3))/6,f=(l+m)*_,u=l-f,d=m-f,p=t-u,c=e-d;p>c?(n=1,o=0):(n=0,o=1);var g=p-n+_,v=c-o+_,C=p-1+2*_,y=c-1+2*_,M=255&l,S=255&m,G=this.perm[M+this.perm[S]]%12,T=this.perm[M+n+this.perm[S+o]]%12,W=this.perm[M+1+this.perm[S+1]]%12,F=.5-p*p-c*c;0>F?i=0:(F*=F,i=F*F*this.dot(this.grad3[G],p,c));var R=.5-g*g-v*v;0>R?s=0:(R*=R,s=R*R*this.dot(this.grad3[T],g,v));var b=.5-C*C-y*y;return 0>b?r=0:(b*=b,r=b*b*this.dot(this.grad3[W],C,y)),70*(i+s+r)},t.prototype.noise3d=function(t,e,i){var s,r,n,o,h,a,l,m,_,f,u=1/3,d=(t+e+i)*u,p=Math.floor(t+d),c=Math.floor(e+d),g=Math.floor(i+d),v=1/6,C=(p+c+g)*v,y=p-C,M=c-C,S=g-C,G=t-y,T=e-M,W=i-S;G>=T?T>=W?(h=1,a=0,l=0,m=1,_=1,f=0):G>=W?(h=1,a=0,l=0,m=1,_=0,f=1):(h=0,a=0,l=1,m=1,_=0,f=1):W>T?(h=0,a=0,l=1,m=0,_=1,f=1):W>G?(h=0,a=1,l=0,m=0,_=1,f=1):(h=0,a=1,l=0,m=1,_=1,f=0);var F=G-h+v,R=T-a+v,b=W-l+v,k=G-m+2*v,P=T-_+2*v,x=W-f+2*v,U=G-1+3*v,w=T-1+3*v,B=W-1+3*v,I=255&p,A=255&c,N=255&g,V=this.perm[I+this.perm[A+this.perm[N]]]%12,Y=this.perm[I+h+this.perm[A+a+this.perm[N+l]]]%12,D=this.perm[I+m+this.perm[A+_+this.perm[N+f]]]%12,E=this.perm[I+1+this.perm[A+1+this.perm[N+1]]]%12,L=.6-G*G-T*T-W*W;0>L?s=0:(L*=L,s=L*L*this.dot(this.grad3[V],G,T,W));var X=.6-F*F-R*R-b*b;0>X?r=0:(X*=X,r=X*X*this.dot(this.grad3[Y],F,R,b));var q=.6-k*k-P*P-x*x;0>q?n=0:(q*=q,n=q*q*this.dot(this.grad3[D],k,P,x));var z=.6-U*U-w*w-B*B;return 0>z?o=0:(z*=z,o=z*z*this.dot(this.grad3[E],U,w,B)),32*(s+r+n+o)},t}();
