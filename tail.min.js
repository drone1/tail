!function(t,e){t.Tail=e()}(window,function(){"use strict";function t(t){this.m_Canvas=document.getElementById(t.canvas_id),this.m_nRootX=t.root_pos_x,this.m_nRootY=t.root_pos_y,this.m_flBaseAngle=CatUtils.DegreesToRadians(t.base_angle),this.m_cSegments=Math.max(2,t.segment_count),this.m_flTailLengthPercentage=t.tail_length,this.m_strFillColor=t.fill_color,this.m_strStrokeColor=t.stroke_color,this.m_flStrokeWidth=t.stroke_width,this.m_flStartWidth=t.start_width,this.m_flEndWidth=t.end_width,this.m_bCollideWithFloor=t.collide_with_floor,this.m_fnGetMaxAngle=t.get_max_angle_func,this.m_fnGetCurlynessPoints=t.get_curlyness_points_func,this.m_fnGetCurlynessValues=t.get_curlyness_values_func,this.m_fnGetTailWidthPoints=t.get_tail_width_points,this.m_fnGetTailWidthValues=t.get_tail_width_values,this.m_fnFrantic=t.frantic_func,this.m_bAnimate=void 0!==t.animate?t.animate:!0,this.m_flNoiseBase=1e4*Math.random(),this.m_bFirstFrame=!0,this.m_Noise=new SimplexNoise}return t.prototype.BIsVisible=function(){var t=CatUtils.GetElementPositionInViewportSpace(this.m_Canvas).y,e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=window.pageYOffset;return!(t>i+e||t+this.m_Canvas.height<0)},t.prototype.Render=function(){if(this.BIsVisible()){var t=this.m_Canvas.getContext("2d");t.save();var e=this.m_bAnimate?CatUtils.GetTime():0,i=this.m_Canvas.width,s=this.m_Canvas.height,r=this.m_strStrokeColor&&this.m_strStrokeColor.length&&this.m_flStrokeWidth>1;t.clearRect(0,0,i,s);var n=i/this.m_cSegments*this.m_flTailLengthPercentage;t.lineCap="round",(this.m_fnGetCurlynessPoints(e).length!==this.m_fnGetCurlynessValues(e).length||this.m_fnGetTailWidthPoints(e).length!==this.m_fnGetTailWidthValues(e).length)&&console.error("Error: These need to be the same size, and both sorted in ascending order.");for(var o=r?2:1,a=0;o>a;++a){var h=o>1&&0==a,l=0,m=this.m_nRootX,_=this.m_nRootY;t.save(),t.translate(this.m_nRootX,this.m_nRootY);for(var f=0;f<this.m_cSegments;++f){var u=f/this.m_cSegments,d=this.GetTailWidth(e,u),c=this.m_Noise.noise(this.m_flNoiseBase+1e4+e+.5*u,100),p=this.GetCurlyness(e,u),g=this.m_fnFrantic(e,u),v=this.m_fnGetMaxAngle(e,u),C=this.m_flBaseAngle+p*Math.min(CatUtils.DegreesToRadians(Math.sin(e+2*Math.PI*u*c*g)*v),v),y=m+n*Math.cos(C),S=_+n*Math.sin(C),T=!1;this.m_bCollideWithFloor&&S>this.m_nRootY&&(S=this.m_nRootY,T=!0),T&&(C=0);var G=C-l;l=C,t.rotate(G);var M,w;h?(M=d*this.m_flStrokeWidth,w=this.m_strStrokeColor):(M=d,w=this.m_strFillColor),t.lineWidth=M,t.strokeStyle=w,t.beginPath(),t.moveTo(0,0),t.lineTo(n,0),t.stroke(),f<this.m_cSegments-1&&t.translate(n,0),m=y,_=S}t.restore()}t.restore(),this.m_bFirstFrame=!1}},t.prototype.GetCurlyness=function(t,e){var i=this.m_fnGetCurlynessPoints(t),s=this.m_fnGetCurlynessValues(t),r=CatUtils.BinarySearch(e,i);return CatUtils.Interpolate(e,i[r],i[r+1],s[r],s[r+1])},t.prototype.GetTailWidth=function(t,e){var i=this.m_fnGetTailWidthPoints(t),s=this.m_fnGetTailWidthValues(t),r=CatUtils.BinarySearch(e,i);return CatUtils.Interpolate(e,i[r],i[r+1],s[r],s[r+1])},t.prototype.LogIfFirstFrame=function(t){this.m_bFirstFrame&&console.log(t)},t});var CatUtils={GetTime:function(){return(new Date).getTime()/1e3},GetElementPositionInViewportSpace:function(t){for(var e=0,i=0;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,i+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{x:e,y:i}},Clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},Interpolate:function(t,e,i,s,r){if(e==i)return t>=i?r:s;var n=CatUtils.Clamp((t-e)/(i-e),0,1);return s+(r-s)*CatUtils.SCurve(n)},SCurve:function(t){var e=t*t;return 3*e-2*e*t},DegreesToRadians:function(t){return t*Math.PI/180},BinarySearch:function(t,e){for(var i=parseInt(e.length/2);i>=0&&i<e.length;)if(t>=e[i]){if(t<=e[i+1])break;++i}else--i;return i}},SimplexNoise=function(){var t=function(){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var t=0;256>t;t++)this.p[t]=Math.floor(256*Math.random());this.perm=[];for(var t=0;512>t;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};return t.prototype.dot=function(t,e,i){return t[0]*e+t[1]*i},t.prototype.noise=function(t,e){var i,s,r,n,o,a=.5*(Math.sqrt(3)-1),h=(t+e)*a,l=Math.floor(t+h),m=Math.floor(e+h),_=(3-Math.sqrt(3))/6,f=(l+m)*_,u=l-f,d=m-f,c=t-u,p=e-d;c>p?(n=1,o=0):(n=0,o=1);var g=c-n+_,v=p-o+_,C=c-1+2*_,y=p-1+2*_,S=255&l,T=255&m,G=this.perm[S+this.perm[T]]%12,M=this.perm[S+n+this.perm[T+o]]%12,w=this.perm[S+1+this.perm[T+1]]%12,W=.5-c*c-p*p;0>W?i=0:(W*=W,i=W*W*this.dot(this.grad3[G],c,p));var b=.5-g*g-v*v;0>b?s=0:(b*=b,s=b*b*this.dot(this.grad3[M],g,v));var F=.5-C*C-y*y;return 0>F?r=0:(F*=F,r=F*F*this.dot(this.grad3[w],C,y)),70*(i+s+r)},t.prototype.noise3d=function(t,e,i){var s,r,n,o,a,h,l,m,_,f,u=1/3,d=(t+e+i)*u,c=Math.floor(t+d),p=Math.floor(e+d),g=Math.floor(i+d),v=1/6,C=(c+p+g)*v,y=c-C,S=p-C,T=g-C,G=t-y,M=e-S,w=i-T;G>=M?M>=w?(a=1,h=0,l=0,m=1,_=1,f=0):G>=w?(a=1,h=0,l=0,m=1,_=0,f=1):(a=0,h=0,l=1,m=1,_=0,f=1):w>M?(a=0,h=0,l=1,m=0,_=1,f=1):w>G?(a=0,h=1,l=0,m=0,_=1,f=1):(a=0,h=1,l=0,m=1,_=1,f=0);var W=G-a+v,b=M-h+v,F=w-l+v,P=G-m+2*v,R=M-_+2*v,k=w-f+2*v,x=G-1+3*v,I=M-1+3*v,U=w-1+3*v,B=255&c,V=255&p,A=255&g,E=this.perm[B+this.perm[V+this.perm[A]]]%12,L=this.perm[B+a+this.perm[V+h+this.perm[A+l]]]%12,N=this.perm[B+m+this.perm[V+_+this.perm[A+f]]]%12,Y=this.perm[B+1+this.perm[V+1+this.perm[A+1]]]%12,D=.6-G*G-M*M-w*w;0>D?s=0:(D*=D,s=D*D*this.dot(this.grad3[E],G,M,w));var X=.6-W*W-b*b-F*F;0>X?r=0:(X*=X,r=X*X*this.dot(this.grad3[L],W,b,F));var q=.6-P*P-R*R-k*k;0>q?n=0:(q*=q,n=q*q*this.dot(this.grad3[N],P,R,k));var H=.6-x*x-I*I-U*U;return 0>H?o=0:(H*=H,o=H*H*this.dot(this.grad3[Y],x,I,U)),32*(s+r+n+o)},t}();
